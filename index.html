<!DOCTYPE html>
<html lang="en">

<head>
    <title>seanwasere youtube webcam as texture using three.js</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            color: white;
            font-family: Monospace;
            font-size: 13px;
            text-align: center;
            background-color: black;
            margin: 0px;
            overflow: hidden;
        }

        container {
            border: 1px solid red;
        }
    </style>
</head>

<body>
    <div id="container"></div>
    <video id="webcam" autoplay width="360" height="240" style="visibility: hidden; float:left;"></video>
    <canvas id="canvas" width="360" height="240" style="visibility: hidden; float:left;"></canvas>
    <script src="js/three.min.js"></script>

    <script src="js/controls/OrbitControls.js"></script>

    <script>
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
        window.URL = window.URL || window.webkitURL;

        var camvideo = document.getElementById('webcam');

        if (!navigator.getUserMedia) {
            alert('Sorry. <code>navigator.getUserMedia()</code> is not available.');
        } else {
            navigator.getUserMedia({ video: true }, gotStream, noStream);
        }

        function gotStream(stream) {
            if (window.URL) { camvideo.src = window.URL.createObjectURL(stream); }
            else // Opera
            { camvideo.src = stream; }

            camvideo.onerror = function (e) { stream.stop(); };

            stream.onended = noStream;
        }

        function noStream(e) {
            var msg = 'No camera available.';
            if (e.code == 1) { msg = 'User denied access to use camera.'; }
            alert(msg);
        }

        var container;
        var scene;
        var camera;
        var renderer;
        var controls;
        var canvas;
        var canvasCtx;

        var webcam;
        var webcamTexture;

        init();
        animate();

        function init() {
            scene = new THREE.Scene();

            var width = window.innerWidth;
            var height = window.innerHeight;
            camera = new THREE.PerspectiveCamera(45, (width / height), .1, 20000);
            scene.add(camera);
            camera.position.set(0, 0, 100);
            camera.lookAt(scene.position);

            renderer = new THREE.WebGLRenderer();
            renderer.setClearColor(0x000000);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);

            container = document.getElementById('container');
            container.appendChild(renderer.domElement);

            window.addEventListener('resize', onWindowResize, false);

            controls = new THREE.OrbitControls(camera, renderer.domElement);

            webcam = document.getElementById('webcam');

            canvas = document.getElementById('canvas');
            canvasCtx = canvas.getContext('2d');
            canvasCtx.fillStyle = '#000000';
            canvasCtx.fillRect(0, 0, canvas.width, canvas.height);

            webcamTexture = new THREE.Texture(canvas);
            webcamTexture.minFilter = THREE.LinearFilter;
            webcamTexture.magFilter = THREE.LinearFilter;

            var geometry = new THREE.BoxGeometry(1, 1, 1);
            var material = new THREE.MeshBasicMaterial({ map: webcamTexture, overdraw: true, side: THREE.FrontSide });
            var cube = new THREE.Mesh(geometry, material);
            cube.position.set(0, 0, 0);
            cube.scale.x = 32;
            cube.scale.y = 24;
            cube.scale.z = 32;
            scene.add(cube);
        }


        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        function animate() {
            requestAnimationFrame(animate);
            if (webcam.readyState === webcam.HAVE_ENOUGH_DATA) {
                canvasCtx.drawImage(webcam, 0, 0, canvas.width, canvas.height);
                if (webcamTexture)
                    webcamTexture.needsUpdate = true;
            }

            renderer.render(scene, camera);
            controls.update();
        }

    </script>

</body>

</html>
